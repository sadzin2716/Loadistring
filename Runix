--// ===== CONFIG ===== //--
local highlightFill = Color3.fromRGB(255, 255, 255)
local highlightOutline = Color3.fromRGB(255, 255, 255)
--// ==================== //--

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer

-- Cria a GUI
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "ESP_GUI"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")

-- Botão principal
local Button = Instance.new("TextButton")
Button.Size = UDim2.new(0, 120, 0, 40)
Button.Position = UDim2.new(0.1, 0, 0.3, 0)
Button.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
Button.Text = "ESP: OFF"
Button.TextColor3 = Color3.fromRGB(255, 255, 255)
Button.Font = Enum.Font.GothamBold
Button.TextSize = 18
Button.AutoButtonColor = false
Button.BorderSizePixel = 0
Button.Parent = ScreenGui

-- Estilo suave
local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0, 10)
UICorner.Parent = Button

local UIStroke = Instance.new("UIStroke")
UIStroke.Color = Color3.fromRGB(255,255,255)
UIStroke.Thickness = 1.6
UIStroke.Parent = Button

-- Arrastar botão
local dragging, dragInput, startPos, startMousePos

Button.InputBegan:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 then
		dragging = true
		startMousePos = input.Position
		startPos = Button.Position

		input.Changed:Connect(function()
			if input.UserInputState == Enum.UserInputState.End then
				dragging = false
			end
		end)
	end
end)

Button.InputChanged:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseMovement then
		dragInput = input
	end
end)

RunService.RenderStepped:Connect(function()
	if dragging and dragInput then
		local delta = dragInput.Position - startMousePos
		Button.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
	end
end)

-- ESP functions
local ESP_Enabled = false
local ActiveHighlights = {}

local function CreateESP(player)
	if player == LocalPlayer then return end

	local character = player.Character
	if not character then return end

	if ActiveHighlights[player] then return end

	local highlight = Instance.new("Highlight")
	highlight.FillColor = highlightFill
	highlight.OutlineColor = highlightOutline
	highlight.FillTransparency = 0.75
	highlight.OutlineTransparency = 0
	highlight.Adornee = character
	highlight.Parent = character

	ActiveHighlights[player] = highlight
end

local function RemoveESP(player)
	if ActiveHighlights[player] then
		ActiveHighlights[player]:Destroy()
		ActiveHighlights[player] = nil
	end
end

-- Atualização contínua do ESP
RunService.RenderStepped:Connect(function()
	if not ESP_Enabled then return end

	for _, player in pairs(Players:GetPlayers()) do
		if player ~= LocalPlayer then
			if player.Character then
				CreateESP(player)
			end
		end
	end
end)

Players.PlayerRemoving:Connect(function(player)
	RemoveESP(player)
end)

-- Toggle ESP On/Off
Button.MouseButton1Click:Connect(function()
	ESP_Enabled = not ESP_Enabled

	Button.Text = "ESP: " .. (ESP_Enabled and "ON" or "OFF")

	if not ESP_Enabled then
		for p,h in pairs(ActiveHighlights) do
			if h then h:Destroy() end
		end
		ActiveHighlights = {}
	end
end)
